\hypertarget{classI2Cdev}{}\section{I2\+Cdev Class Reference}
\label{classI2Cdev}\index{I2Cdev@{I2Cdev}}


{\ttfamily \#include $<$I2\+Cdev.\+h$>$}

Inheritance diagram for I2\+Cdev\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=1.676647cm]{classI2Cdev}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classI2Cdev_afd73def195a0441baf3e4dd774de606f}{I2\+Cdev}} (const i2c\+\_\+port\+\_\+t \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}})
\item 
\mbox{\hyperlink{classI2Cdev_af9aa307995256fd1ea40e25c956e76fd}{$\sim$\+I2\+Cdev}} ()
\item 
void \mbox{\hyperlink{classI2Cdev_a3be31bf7d3f40bb215d8854aac945db3}{Select\+Register}} (uint8\+\_\+t dev, uint8\+\_\+t reg)
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_ab028a4f330f4f31dc8af9890431a2a63}{read\+Bit}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t bit\+Num, uint8\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_a362d1d9bf44d01f0dfd7db94df8a61e5}{read\+Bits}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t bit\+Start, uint8\+\_\+t length, uint8\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_a80bf7daa6a6c34df95de78ac54d01b1f}{read\+Byte}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_af62cd3a62562c704c6f183ea7a42064d}{read\+Word}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint16\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_ab1ba3954fcc16341aa6e04e0a569c0ea}{read\+Bytes}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t length, uint8\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
bool \mbox{\hyperlink{classI2Cdev_aa68890af87de5471d32e583ebbd91acb}{write\+Bit}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t bit\+Num, uint8\+\_\+t data)
\item 
bool \mbox{\hyperlink{classI2Cdev_a913371251b6a41520c080115650e1b59}{write\+Bits}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t bit\+Start, uint8\+\_\+t length, uint8\+\_\+t data)
\item 
bool \mbox{\hyperlink{classI2Cdev_aeb297637ef985cd562da465ba61b7042}{write\+Byte}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t data)
\item 
bool \mbox{\hyperlink{classI2Cdev_aa4e39cac6c0eac5112f9132084bcc93e}{write\+Bytes}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t length, uint8\+\_\+t $\ast$data)
\item 
bool \mbox{\hyperlink{classI2Cdev_acbe68a802d6a177301736e60bedd1def}{write\+Word}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint16\+\_\+t data)
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{classI2Cdev_a794a92b925f7970399f8b148caa5eef8}{initialize}} (gpio\+\_\+num\+\_\+t sda, gpio\+\_\+num\+\_\+t scl, bool sda\+Pull\+Up=false, bool scl\+Pull\+Up=false, uint32\+\_\+t frequency=100000\+U\+L)
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}{read\+Byte\+\_\+}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
int8\+\_\+t \mbox{\hyperlink{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}{read\+Bytes\+\_\+}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t length, uint8\+\_\+t $\ast$data, uint16\+\_\+t timeout=\mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}})
\item 
bool \mbox{\hyperlink{classI2Cdev_a97645c5d6a3e295bb72b9ee5ab810d12}{write\+Byte\+\_\+}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t data)
\item 
bool \mbox{\hyperlink{classI2Cdev_a2f9176cd44c3163ca3929ac1c2ff601b}{write\+Bytes\+\_\+}} (uint8\+\_\+t dev\+Addr, uint8\+\_\+t reg\+Addr, uint8\+\_\+t length, uint8\+\_\+t $\ast$data)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
const i2c\+\_\+port\+\_\+t \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}
\item 
bool \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The I2C bus operator. 

Definition at line 58 of file I2\+Cdev.\+h.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classI2Cdev_afd73def195a0441baf3e4dd774de606f}\label{classI2Cdev_afd73def195a0441baf3e4dd774de606f}} 
\index{I2Cdev@{I2Cdev}!I2Cdev@{I2Cdev}}
\index{I2Cdev@{I2Cdev}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{I2Cdev()}{I2Cdev()}}
{\footnotesize\ttfamily I2\+Cdev\+::\+I2\+Cdev (\begin{DoxyParamCaption}\item[{const i2c\+\_\+port\+\_\+t}]{port }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}}

Creates an instance to an I2C device on the specified port.


\begin{DoxyParams}{Parameters}
{\em port} & the I2C port \\
\hline
\end{DoxyParams}


Definition at line 49 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{50     : \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}((static\_cast<unsigned>(\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}) | 1u) == 1u ? \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}} : I2C\_NUM\_0),}
\DoxyCodeLine{51       \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}}(\textcolor{keyword}{false}) \{}
\DoxyCodeLine{52   i2c::portRefs[this->\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]++;}
\DoxyCodeLine{53 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_af9aa307995256fd1ea40e25c956e76fd}\label{classI2Cdev_af9aa307995256fd1ea40e25c956e76fd}} 
\index{I2Cdev@{I2Cdev}!````~I2Cdev@{$\sim$I2Cdev}}
\index{````~I2Cdev@{$\sim$I2Cdev}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{$\sim$I2Cdev()}{~I2Cdev()}}
{\footnotesize\ttfamily I2\+Cdev\+::$\sim$\+I2\+Cdev (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Performs I2C bus cleanup on this port, if necessary. 

Definition at line 55 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{55                 \{}
\DoxyCodeLine{56   i2c::portRefs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]--;}
\DoxyCodeLine{57   \textcolor{keywordflow}{if} (i2c::portRefs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}] == 0) \{}
\DoxyCodeLine{58     i2c::initializedPorts[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}] = \textcolor{keyword}{false};}
\DoxyCodeLine{59     i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}] = \{\};}
\DoxyCodeLine{60     i2c\_driver\_delete(\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}});}
\DoxyCodeLine{61   \}}
\DoxyCodeLine{62 \}}

\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classI2Cdev_a794a92b925f7970399f8b148caa5eef8}\label{classI2Cdev_a794a92b925f7970399f8b148caa5eef8}} 
\index{I2Cdev@{I2Cdev}!initialize@{initialize}}
\index{initialize@{initialize}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{initialize()}{initialize()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::initialize (\begin{DoxyParamCaption}\item[{gpio\+\_\+num\+\_\+t}]{sda,  }\item[{gpio\+\_\+num\+\_\+t}]{scl,  }\item[{bool}]{sda\+Pull\+Up = {\ttfamily false},  }\item[{bool}]{scl\+Pull\+Up = {\ttfamily false},  }\item[{uint32\+\_\+t}]{frequency = {\ttfamily 100000UL} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Initializes the I2C port if not already and verifies this device is there.


\begin{DoxyParams}{Parameters}
{\em sda} & the S\+DA pin \\
\hline
{\em scl} & the S\+CL pin \\
\hline
{\em sda\+Pull\+Up} & whether S\+DA is a pullup \\
\hline
{\em scl\+Pull\+Up} & whether S\+CL is a pullup \\
\hline
{\em frequency} & the bus frequency \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
whether initialization was successfull 
\end{DoxyReturn}


Definition at line 64 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{65                                                                             \{}
\DoxyCodeLine{66   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{67   \mbox{\hyperlink{classErrorHandler}{ErrorHandler<>}} check(\textcolor{stringliteral}{"I2Cdev"});}
\DoxyCodeLine{68   \textcolor{keywordflow}{if} (i2c::initializedPorts[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]) \{}
\DoxyCodeLine{69     \textcolor{keywordflow}{if} (sda != i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].sda\_io\_num}
\DoxyCodeLine{70         || scl != i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].scl\_io\_num}
\DoxyCodeLine{71         || sdaPullUp != i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].sda\_pullup\_en}
\DoxyCodeLine{72         || sclPullUp != i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].scl\_pullup\_en) \{}
\DoxyCodeLine{73       i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].sda\_io\_num = sda;}
\DoxyCodeLine{74       i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].scl\_io\_num = scl;}
\DoxyCodeLine{75       i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].sda\_pullup\_en = sdaPullUp ? GPIO\_PULLUP\_ENABLE}
\DoxyCodeLine{76                                                    : GPIO\_PULLUP\_DISABLE;}
\DoxyCodeLine{77       i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].scl\_pullup\_en = sclPullUp ? GPIO\_PULLUP\_ENABLE}
\DoxyCodeLine{78                                                    : GPIO\_PULLUP\_DISABLE;}
\DoxyCodeLine{79       \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}} = check(i2c\_set\_pin, \textcolor{stringliteral}{"I2C set pin"}, \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}},}
\DoxyCodeLine{80                           static\_cast<int>(i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].sda\_io\_num),}
\DoxyCodeLine{81                           static\_cast<int>(i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].scl\_io\_num),}
\DoxyCodeLine{82                           i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].sda\_pullup\_en,}
\DoxyCodeLine{83                           i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}].scl\_pullup\_en,}
\DoxyCodeLine{84                           I2C\_MODE\_MASTER).runCheck();}
\DoxyCodeLine{85     \} \textcolor{keywordflow}{else} \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}} = \textcolor{keyword}{true};}
\DoxyCodeLine{86   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{87     i2c\_config\_t \&config = i2c::configs[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}];}
\DoxyCodeLine{88     config.mode = I2C\_MODE\_MASTER;}
\DoxyCodeLine{89     config.sda\_io\_num = static\_cast<gpio\_num\_t>(sda);}
\DoxyCodeLine{90     config.sda\_pullup\_en = sdaPullUp ? GPIO\_PULLUP\_ENABLE}
\DoxyCodeLine{91                                      : GPIO\_PULLUP\_DISABLE;}
\DoxyCodeLine{92     config.scl\_io\_num = static\_cast<gpio\_num\_t>(scl);}
\DoxyCodeLine{93     config.scl\_pullup\_en = sclPullUp ? GPIO\_PULLUP\_ENABLE}
\DoxyCodeLine{94                                      : GPIO\_PULLUP\_DISABLE;}
\DoxyCodeLine{95     config.master.clk\_speed = frequency;}
\DoxyCodeLine{96     \textcolor{keyword}{const} i2c\_config\_t *\mbox{\hyperlink{LidarMap_8h_abe39d6a8d29b163a040e5bd394fdb872}{conf}} = \&config;}
\DoxyCodeLine{97     \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}} =}
\DoxyCodeLine{98         check(i2c\_param\_config, \textcolor{stringliteral}{"I2C Param Config"}, \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}, \mbox{\hyperlink{LidarMap_8h_abe39d6a8d29b163a040e5bd394fdb872}{conf}})}
\DoxyCodeLine{99             (i2c\_driver\_install, \textcolor{stringliteral}{"I2C Driver Install"},}
\DoxyCodeLine{100              \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}, I2C\_MODE\_MASTER, static\_cast<size\_t>(0),}
\DoxyCodeLine{101              static\_cast<size\_t>(0), 0).runCheck();}
\DoxyCodeLine{102   \}}
\DoxyCodeLine{103   i2c::initializedPorts[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}] = \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}};}
\DoxyCodeLine{104   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}{initialized}};}
\DoxyCodeLine{105 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_ab028a4f330f4f31dc8af9890431a2a63}\label{classI2Cdev_ab028a4f330f4f31dc8af9890431a2a63}} 
\index{I2Cdev@{I2Cdev}!readBit@{readBit}}
\index{readBit@{readBit}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readBit()}{readBit()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Bit (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{bit\+Num,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})}

Reads a single bit with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em bit\+Num} & the bit number in the register \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the length of data read 
\end{DoxyReturn}


Definition at line 107 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{111                                          \{}
\DoxyCodeLine{112   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{113   uint8\_t b;}
\DoxyCodeLine{114   uint8\_t count = \mbox{\hyperlink{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}{readByte\_}}(devAddr, regAddr, \&b, timeout);}
\DoxyCodeLine{115   *data = b \& (1u << bitNum);}
\DoxyCodeLine{116   \textcolor{keywordflow}{return} count;}
\DoxyCodeLine{117 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a362d1d9bf44d01f0dfd7db94df8a61e5}\label{classI2Cdev_a362d1d9bf44d01f0dfd7db94df8a61e5}} 
\index{I2Cdev@{I2Cdev}!readBits@{readBits}}
\index{readBits@{readBits}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readBits()}{readBits()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Bits (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{bit\+Start,  }\item[{uint8\+\_\+t}]{length,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})}

Reads multiple bits with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em bit\+Start} & the register bit to start \\
\hline
{\em length} & the number of bytes to read \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the length of data read 
\end{DoxyReturn}


Definition at line 119 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{124                                           \{}
\DoxyCodeLine{125   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{126   \textcolor{comment}{// 01101001 read byte}}
\DoxyCodeLine{127   \textcolor{comment}{// 76543210 bit numbers}}
\DoxyCodeLine{128   \textcolor{comment}{//    xxx   args: bitStart=4, length=3}}
\DoxyCodeLine{129   \textcolor{comment}{//    010   masked}}
\DoxyCodeLine{130   \textcolor{comment}{//   -> 010 shifted}}
\DoxyCodeLine{131   uint8\_t count, b;}
\DoxyCodeLine{132   \textcolor{keywordflow}{if} ((count = \mbox{\hyperlink{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}{readByte\_}}(devAddr, regAddr, \&b, timeout)) != 0) \{}
\DoxyCodeLine{133     uint8\_t mask = static\_cast<uint8\_t>((1u << length) - 1)}
\DoxyCodeLine{134         << static\_cast<uint8\_t>(bitStart - length + 1);}
\DoxyCodeLine{135     b \&= mask;}
\DoxyCodeLine{136     b >>= static\_cast<uint8\_t>(bitStart - length + 1);}
\DoxyCodeLine{137     *data = b;}
\DoxyCodeLine{138   \}}
\DoxyCodeLine{139   \textcolor{keywordflow}{return} count;}
\DoxyCodeLine{140 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a80bf7daa6a6c34df95de78ac54d01b1f}\label{classI2Cdev_a80bf7daa6a6c34df95de78ac54d01b1f}} 
\index{I2Cdev@{I2Cdev}!readByte@{readByte}}
\index{readByte@{readByte}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readByte()}{readByte()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Byte (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})}

Reads a single byte with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read. 
\end{DoxyReturn}


Definition at line 148 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{151                                           \{}
\DoxyCodeLine{152   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{153   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}{readBytes\_}}(devAddr, regAddr, 1, data, timeout);}
\DoxyCodeLine{154 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}\label{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}} 
\index{I2Cdev@{I2Cdev}!readByte\_@{readByte\_}}
\index{readByte\_@{readByte\_}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readByte\_()}{readByte\_()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Byte\+\_\+ (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Reads a single byte.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read. 
\end{DoxyReturn}


Definition at line 141 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{144                                            \{}
\DoxyCodeLine{145   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}{readBytes\_}}(devAddr, regAddr, 1, data, timeout);}
\DoxyCodeLine{146 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_ab1ba3954fcc16341aa6e04e0a569c0ea}\label{classI2Cdev_ab1ba3954fcc16341aa6e04e0a569c0ea}} 
\index{I2Cdev@{I2Cdev}!readBytes@{readBytes}}
\index{readBytes@{readBytes}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readBytes()}{readBytes()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Bytes (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{length,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})}

Reads multiple words with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em length} & the number of bytes to read \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read. 
\end{DoxyReturn}


Definition at line 201 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{205                                            \{}
\DoxyCodeLine{206   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{207   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}{readBytes\_}}(devAddr, regAddr, length, data, timeout);}
\DoxyCodeLine{208 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}\label{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}} 
\index{I2Cdev@{I2Cdev}!readBytes\_@{readBytes\_}}
\index{readBytes\_@{readBytes\_}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readBytes\_()}{readBytes\_()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Bytes\+\_\+ (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{length,  }\item[{uint8\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Reads multiple bytes.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em length} & the number of bytes to read \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read. 
\end{DoxyReturn}


Definition at line 156 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{160                                             \{}
\DoxyCodeLine{161   i2c\_cmd\_handle\_t cmd;}
\DoxyCodeLine{162   \mbox{\hyperlink{classI2Cdev_a3be31bf7d3f40bb215d8854aac945db3}{SelectRegister}}(devAddr, regAddr);}
\DoxyCodeLine{163   \mbox{\hyperlink{classErrorHandler}{ErrorHandler<>}} check(\textcolor{stringliteral}{"I2Cdev"});}
\DoxyCodeLine{164 }
\DoxyCodeLine{165   cmd = i2c\_cmd\_link\_create();}
\DoxyCodeLine{166   check(i2c\_master\_start, \textcolor{stringliteral}{"I2C Start"}, cmd)}
\DoxyCodeLine{167       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd,}
\DoxyCodeLine{168        static\_cast<uint8\_t>(static\_cast<uint8\_t>(}
\DoxyCodeLine{169            devAddr << 1u) | I2C\_MASTER\_READ}
\DoxyCodeLine{170        ), \textcolor{keyword}{true});}
\DoxyCodeLine{171 \textcolor{comment}{//  ESP\_ERROR\_CHECK(i2c\_master\_start(cmd))}}
\DoxyCodeLine{172 \textcolor{comment}{//  ESP\_ERROR\_CHECK(i2c\_master\_write\_byte(cmd,}}
\DoxyCodeLine{173 \textcolor{comment}{//                                      static\_cast<uint8\_t>(devAddr << 1u)}}
\DoxyCodeLine{174 \textcolor{comment}{//                                          | I2C\_MASTER\_READ,}}
\DoxyCodeLine{175 \textcolor{comment}{//                                      1))}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177   \textcolor{keywordflow}{if} (length > 1)}
\DoxyCodeLine{178     check(i2c\_master\_read, \textcolor{stringliteral}{"I2C Read"}, cmd, data,}
\DoxyCodeLine{179           static\_cast<size\_t>(length - 1),}
\DoxyCodeLine{180           I2C\_MASTER\_ACK);}
\DoxyCodeLine{181 \textcolor{comment}{//  ESP\_ERROR\_CHECK(i2c\_master\_read(cmd, data, length - 1, I2C\_MASTER\_ACK))}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183   check(i2c\_master\_read\_byte, \textcolor{stringliteral}{"I2C Read Byte"},}
\DoxyCodeLine{184         cmd, data + length - 1, I2C\_MASTER\_NACK);}
\DoxyCodeLine{185 \textcolor{comment}{//  ESP\_ERROR\_CHECK(i2c\_master\_read\_byte(cmd,}}
\DoxyCodeLine{186 \textcolor{comment}{//                                     data + length - 1,}}
\DoxyCodeLine{187 \textcolor{comment}{//                                     I2C\_MASTER\_NACK))}}
\DoxyCodeLine{188 }
\DoxyCodeLine{189   check(i2c\_master\_stop, \textcolor{stringliteral}{"I2C Stop"}, cmd)}
\DoxyCodeLine{190       (i2c\_master\_cmd\_begin, \textcolor{stringliteral}{"I2C CMD Begin"}, \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}, cmd,}
\DoxyCodeLine{191        1000 / portTICK\_PERIOD\_MS);}
\DoxyCodeLine{192 \textcolor{comment}{//  ESP\_ERROR\_CHECK(i2c\_master\_cmd\_begin(port,}}
\DoxyCodeLine{193 \textcolor{comment}{//                                     cmd,}}
\DoxyCodeLine{194 \textcolor{comment}{//                                     1000 / portTICK\_PERIOD\_MS))}}
\DoxyCodeLine{195   check.runCheck();}
\DoxyCodeLine{196   i2c\_cmd\_link\_delete(cmd);}
\DoxyCodeLine{197 }
\DoxyCodeLine{198   \textcolor{keywordflow}{return} length;}
\DoxyCodeLine{199 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_af62cd3a62562c704c6f183ea7a42064d}\label{classI2Cdev_af62cd3a62562c704c6f183ea7a42064d}} 
\index{I2Cdev@{I2Cdev}!readWord@{readWord}}
\index{readWord@{readWord}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{readWord()}{readWord()}}
{\footnotesize\ttfamily int8\+\_\+t I2\+Cdev\+::read\+Word (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint16\+\_\+t $\ast$}]{data,  }\item[{uint16\+\_\+t}]{timeout = {\ttfamily \mbox{\hyperlink{I2Cdev_8h_ad9726bb02451bb8f59d3d2729e4cd20e}{I2\+C\+D\+E\+V\+\_\+\+D\+E\+F\+A\+U\+L\+T\+\_\+\+R\+E\+A\+D\+\_\+\+T\+I\+M\+E\+O\+UT}}} }\end{DoxyParamCaption})}

Reads a single word with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em data} & the destination to read into \\
\hline
{\em timeout} & read timeout \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read. 
\end{DoxyReturn}


Definition at line 210 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{213                                           \{}
\DoxyCodeLine{214   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{215   uint8\_t msb[2] = \{0, 0\};}
\DoxyCodeLine{216   \mbox{\hyperlink{classI2Cdev_a3fae6b1ae9e9398b682eb7bdf6b43561}{readBytes\_}}(devAddr, regAddr, 2, msb);}
\DoxyCodeLine{217   *data = (static\_cast<uint16\_t>(msb[0] << 8u) | msb[1]);}
\DoxyCodeLine{218   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{219 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a3be31bf7d3f40bb215d8854aac945db3}\label{classI2Cdev_a3be31bf7d3f40bb215d8854aac945db3}} 
\index{I2Cdev@{I2Cdev}!SelectRegister@{SelectRegister}}
\index{SelectRegister@{SelectRegister}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{SelectRegister()}{SelectRegister()}}
{\footnotesize\ttfamily void I2\+Cdev\+::\+Select\+Register (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev,  }\item[{uint8\+\_\+t}]{reg }\end{DoxyParamCaption})}

Selects a device register.


\begin{DoxyParams}{Parameters}
{\em dev} & the device \\
\hline
{\em reg} & the register \\
\hline
\end{DoxyParams}


Definition at line 221 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{221                                                     \{}
\DoxyCodeLine{222   i2c\_cmd\_handle\_t cmd;}
\DoxyCodeLine{223 }
\DoxyCodeLine{224   cmd = i2c\_cmd\_link\_create();}
\DoxyCodeLine{225   \mbox{\hyperlink{classErrorHandler}{ErrorHandler<>}}(\textcolor{stringliteral}{"I2Cdev"})}
\DoxyCodeLine{226       (i2c\_master\_start, \textcolor{stringliteral}{"I2C Start"}, cmd)}
\DoxyCodeLine{227       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd,}
\DoxyCodeLine{228        static\_cast<uint8\_t>(static\_cast<uint8\_t>(dev << 1u)}
\DoxyCodeLine{229            | I2C\_MASTER\_WRITE),}
\DoxyCodeLine{230        \textcolor{keyword}{true})}
\DoxyCodeLine{231       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, reg, \textcolor{keyword}{true})}
\DoxyCodeLine{232       (i2c\_master\_stop, \textcolor{stringliteral}{"I2C Stop"}, cmd)}
\DoxyCodeLine{233       (i2c\_master\_cmd\_begin, \textcolor{stringliteral}{"I2C Begin"}, \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}, cmd,}
\DoxyCodeLine{234        1000 / portTICK\_PERIOD\_MS)}
\DoxyCodeLine{235       .\mbox{\hyperlink{classErrorHandler_a2fb21215e61a07ab1ef590ec98629039}{runCheck}}();}
\DoxyCodeLine{236   i2c\_cmd\_link\_delete(cmd);}
\DoxyCodeLine{237 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_aa68890af87de5471d32e583ebbd91acb}\label{classI2Cdev_aa68890af87de5471d32e583ebbd91acb}} 
\index{I2Cdev@{I2Cdev}!writeBit@{writeBit}}
\index{writeBit@{writeBit}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeBit()}{writeBit()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Bit (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{bit\+Num,  }\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}

Writes a single bit with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em bit\+Num} & the register bit to write \\
\hline
{\em data} & the data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded 
\end{DoxyReturn}


Definition at line 239 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{242                                     \{}
\DoxyCodeLine{243   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{244   uint8\_t b;}
\DoxyCodeLine{245   \mbox{\hyperlink{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}{readByte\_}}(devAddr, regAddr, \&b);}
\DoxyCodeLine{246   b = (data != 0) ? (b | (1u << bitNum)) : (b \& ~(1u << bitNum));}
\DoxyCodeLine{247   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a97645c5d6a3e295bb72b9ee5ab810d12}{writeByte\_}}(devAddr, regAddr, b);}
\DoxyCodeLine{248 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a913371251b6a41520c080115650e1b59}\label{classI2Cdev_a913371251b6a41520c080115650e1b59}} 
\index{I2Cdev@{I2Cdev}!writeBits@{writeBits}}
\index{writeBits@{writeBits}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeBits()}{writeBits()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Bits (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{bit\+Start,  }\item[{uint8\+\_\+t}]{length,  }\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}

Writes multiple bits with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em bit\+Start} & the register bit to start \\
\hline
{\em length} & the number of bytes to write \\
\hline
{\em data} & the data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded 
\end{DoxyReturn}


Definition at line 250 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{254                                      \{}
\DoxyCodeLine{255   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{256   \textcolor{comment}{//      010 value to write}}
\DoxyCodeLine{257   \textcolor{comment}{// 76543210 bit numbers}}
\DoxyCodeLine{258   \textcolor{comment}{//    xxx   args: bitStart=4, length=3}}
\DoxyCodeLine{259   \textcolor{comment}{// 00011100 mask byte}}
\DoxyCodeLine{260   \textcolor{comment}{// 10101111 original value (sample)}}
\DoxyCodeLine{261   \textcolor{comment}{// 10100011 original \& ~mask}}
\DoxyCodeLine{262   \textcolor{comment}{// 10101011 masked | value}}
\DoxyCodeLine{263   uint8\_t b = 0;}
\DoxyCodeLine{264   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classI2Cdev_a74447cfadf4d5054ba29b726afcdecd0}{readByte\_}}(devAddr, regAddr, \&b) != 0) \{}
\DoxyCodeLine{265     uint8\_t mask = static\_cast<uint8\_t>((1u << length) - 1)}
\DoxyCodeLine{266         << static\_cast<uint8\_t>(bitStart - length + 1);}
\DoxyCodeLine{267     data <<= static\_cast<uint8\_t>(bitStart - length + 1); \textcolor{comment}{// shift data into}}
\DoxyCodeLine{268     \textcolor{comment}{// correct position}}
\DoxyCodeLine{269     data \&= mask; \textcolor{comment}{// zero all non-important bits in data}}
\DoxyCodeLine{270     b \&= static\_cast<uint8\_t>(~(mask)); \textcolor{comment}{// zero all important bits in existing}}
\DoxyCodeLine{271     \textcolor{comment}{// byte}}
\DoxyCodeLine{272     b |= data; \textcolor{comment}{// combine data with existing byte}}
\DoxyCodeLine{273     \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a97645c5d6a3e295bb72b9ee5ab810d12}{writeByte\_}}(devAddr, regAddr, b);}
\DoxyCodeLine{274   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{275     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{276   \}}
\DoxyCodeLine{277 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_aeb297637ef985cd562da465ba61b7042}\label{classI2Cdev_aeb297637ef985cd562da465ba61b7042}} 
\index{I2Cdev@{I2Cdev}!writeByte@{writeByte}}
\index{writeByte@{writeByte}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeByte()}{writeByte()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Byte (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})}

Writes a single byte with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em data} & the data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded 
\end{DoxyReturn}


Definition at line 298 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{298                                                                      \{}
\DoxyCodeLine{299   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{300   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a97645c5d6a3e295bb72b9ee5ab810d12}{writeByte\_}}(devAddr, regAddr, data);}
\DoxyCodeLine{301 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a97645c5d6a3e295bb72b9ee5ab810d12}\label{classI2Cdev_a97645c5d6a3e295bb72b9ee5ab810d12}} 
\index{I2Cdev@{I2Cdev}!writeByte\_@{writeByte\_}}
\index{writeByte\_@{writeByte\_}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeByte\_()}{writeByte\_()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Byte\+\_\+ (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Writes a single byte.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em data} & the data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded 
\end{DoxyReturn}


Definition at line 279 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{279                                                                       \{}
\DoxyCodeLine{280   i2c\_cmd\_handle\_t cmd;}
\DoxyCodeLine{281 }
\DoxyCodeLine{282   cmd = i2c\_cmd\_link\_create();}
\DoxyCodeLine{283   \mbox{\hyperlink{classErrorHandler}{ErrorHandler<>}}(\textcolor{stringliteral}{"I2Cdev"})}
\DoxyCodeLine{284       (i2c\_master\_start, \textcolor{stringliteral}{"I2C Start"}, cmd)}
\DoxyCodeLine{285       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, static\_cast<uint8\_t>(}
\DoxyCodeLine{286            static\_cast<uint8\_t>(devAddr << 1u) | I2C\_MASTER\_WRITE),}
\DoxyCodeLine{287        \textcolor{keyword}{true})}
\DoxyCodeLine{288       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, regAddr, \textcolor{keyword}{true})}
\DoxyCodeLine{289       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, data, \textcolor{keyword}{true})}
\DoxyCodeLine{290       (i2c\_master\_stop, \textcolor{stringliteral}{"I2C Stop"}, cmd)}
\DoxyCodeLine{291       (i2c\_master\_cmd\_begin, \textcolor{stringliteral}{"I2C Begin"}, \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}, cmd, 1000 / portTICK\_PERIOD\_MS)}
\DoxyCodeLine{292       .runCheck();}
\DoxyCodeLine{293   i2c\_cmd\_link\_delete(cmd);}
\DoxyCodeLine{294 }
\DoxyCodeLine{295   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{296 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_aa4e39cac6c0eac5112f9132084bcc93e}\label{classI2Cdev_aa4e39cac6c0eac5112f9132084bcc93e}} 
\index{I2Cdev@{I2Cdev}!writeBytes@{writeBytes}}
\index{writeBytes@{writeBytes}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeBytes()}{writeBytes()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Bytes (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{length,  }\item[{uint8\+\_\+t $\ast$}]{data }\end{DoxyParamCaption})}

Writes multiple bytes with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em length} & the number of bytes to write \\
\hline
{\em data} & the data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded 
\end{DoxyReturn}


Definition at line 326 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{329                                        \{}
\DoxyCodeLine{330   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{331   \textcolor{keywordflow}{return} \mbox{\hyperlink{classI2Cdev_a2f9176cd44c3163ca3929ac1c2ff601b}{writeBytes\_}}(devAddr, regAddr, length, data);}
\DoxyCodeLine{332 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_a2f9176cd44c3163ca3929ac1c2ff601b}\label{classI2Cdev_a2f9176cd44c3163ca3929ac1c2ff601b}} 
\index{I2Cdev@{I2Cdev}!writeBytes\_@{writeBytes\_}}
\index{writeBytes\_@{writeBytes\_}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeBytes\_()}{writeBytes\_()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Bytes\+\_\+ (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint8\+\_\+t}]{length,  }\item[{uint8\+\_\+t $\ast$}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Writes multiple bytes.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em length} & the number of bytes to write \\
\hline
{\em data} & the data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded 
\end{DoxyReturn}


Definition at line 303 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{306                                         \{}
\DoxyCodeLine{307   i2c\_cmd\_handle\_t cmd;}
\DoxyCodeLine{308 }
\DoxyCodeLine{309   cmd = i2c\_cmd\_link\_create();}
\DoxyCodeLine{310   \mbox{\hyperlink{classErrorHandler}{ErrorHandler<>}}(\textcolor{stringliteral}{"I2Cdev"})}
\DoxyCodeLine{311       (i2c\_master\_start, \textcolor{stringliteral}{"I2C Start"}, cmd)}
\DoxyCodeLine{312       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, static\_cast<uint8\_t>(}
\DoxyCodeLine{313           static\_cast<uint8\_t>(devAddr << 1u) | I2C\_MASTER\_WRITE), \textcolor{keyword}{true})}
\DoxyCodeLine{314       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, regAddr, \textcolor{keyword}{true})}
\DoxyCodeLine{315       (i2c\_master\_write, \textcolor{stringliteral}{"I2C Write"}, cmd, data,}
\DoxyCodeLine{316        static\_cast<size\_t>(length - 1), \textcolor{keyword}{false})}
\DoxyCodeLine{317       (i2c\_master\_write\_byte, \textcolor{stringliteral}{"I2C Write Byte"}, cmd, data[length - 1], \textcolor{keyword}{true})}
\DoxyCodeLine{318       (i2c\_master\_stop, \textcolor{stringliteral}{"I2C Stop"}, cmd)}
\DoxyCodeLine{319       (i2c\_master\_cmd\_begin, \textcolor{stringliteral}{"I2C CMD Begin"},}
\DoxyCodeLine{320        \mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}, cmd, 1000 / portTICK\_PERIOD\_MS)}
\DoxyCodeLine{321       .\mbox{\hyperlink{classErrorHandler_a2fb21215e61a07ab1ef590ec98629039}{runCheck}}();}
\DoxyCodeLine{322   i2c\_cmd\_link\_delete(cmd);}
\DoxyCodeLine{323   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{324 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classI2Cdev_acbe68a802d6a177301736e60bedd1def}\label{classI2Cdev_acbe68a802d6a177301736e60bedd1def}} 
\index{I2Cdev@{I2Cdev}!writeWord@{writeWord}}
\index{writeWord@{writeWord}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{writeWord()}{writeWord()}}
{\footnotesize\ttfamily bool I2\+Cdev\+::write\+Word (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{dev\+Addr,  }\item[{uint8\+\_\+t}]{reg\+Addr,  }\item[{uint16\+\_\+t}]{data }\end{DoxyParamCaption})}

Writes a single word with a mutex lock for thread-\/safety.


\begin{DoxyParams}{Parameters}
{\em dev\+Addr} & the device address \\
\hline
{\em reg\+Addr} & the register address \\
\hline
{\em data} & the destination to read into \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if write succeeded. 
\end{DoxyReturn}


Definition at line 334 of file I2\+Cdev.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{334                                                                       \{}
\DoxyCodeLine{335   lock\_guard<mutex> lock(i2c::portLocks[\mbox{\hyperlink{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}{port}}]);}
\DoxyCodeLine{336   uint8\_t data1[] = \{(uint8\_t)(data >> 8u), (uint8\_t)(data \& 0xffu)\};}
\DoxyCodeLine{337   uint8\_t data2[] = \{(uint8\_t)(data \& 0xffu), (uint8\_t)(data >> 8u)\};}
\DoxyCodeLine{338   \mbox{\hyperlink{classI2Cdev_a2f9176cd44c3163ca3929ac1c2ff601b}{writeBytes\_}}(devAddr, regAddr, 2, data1);}
\DoxyCodeLine{339   \mbox{\hyperlink{classI2Cdev_a2f9176cd44c3163ca3929ac1c2ff601b}{writeBytes\_}}(devAddr, regAddr, 2, data2);}
\DoxyCodeLine{340   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{341 \}}

\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}\label{classI2Cdev_a94b914bfcbd0fe1f6fdd7b9c6f4ab921}} 
\index{I2Cdev@{I2Cdev}!initialized@{initialized}}
\index{initialized@{initialized}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{initialized}{initialized}}
{\footnotesize\ttfamily bool I2\+Cdev\+::initialized\hspace{0.3cm}{\ttfamily [protected]}}

Whether the device is initialized. 

Definition at line 67 of file I2\+Cdev.\+h.

\mbox{\Hypertarget{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}\label{classI2Cdev_a1d1e63732aa9f50369172b27a034129c}} 
\index{I2Cdev@{I2Cdev}!port@{port}}
\index{port@{port}!I2Cdev@{I2Cdev}}
\subsubsection{\texorpdfstring{port}{port}}
{\footnotesize\ttfamily const i2c\+\_\+port\+\_\+t I2\+Cdev\+::port\hspace{0.3cm}{\ttfamily [protected]}}

The I2C port for this device. 

Definition at line 63 of file I2\+Cdev.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
main/perif/i2c/\mbox{\hyperlink{I2Cdev_8h}{I2\+Cdev.\+h}}\item 
main/perif/i2c/\mbox{\hyperlink{I2Cdev_8cpp}{I2\+Cdev.\+cpp}}\end{DoxyCompactItemize}
